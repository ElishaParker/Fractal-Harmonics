<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mic Visualizer Test</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #000;
    overflow: hidden;
  }
  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  #startBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #0f0;
    color: #000;
    font-family: monospace;
    font-size: 18px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    z-index: 10;
  }
  #startBtn:hover {
    background: #7f7;
  }
</style>
</head>
<body>
<button id="startBtn">ðŸŽ¤ Start Mic Visualizer</button>
<canvas id="canvas"></canvas>

<script>
const startBtn = document.getElementById('startBtn');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let audioCtx, analyser, dataArray;

startBtn.addEventListener('click', async () => {
  try {
    startBtn.style.display = 'none';
    await startMic();
  } catch (e) {
    console.error(e);
    alert('Microphone access denied.');
    startBtn.style.display = 'block';
  }
});

async function startMic() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const source = audioCtx.createMediaStreamSource(stream);

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  const bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);

  source.connect(analyser);

  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  draw();
}

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function draw() {
  requestAnimationFrame(draw);
  if (!analyser) return;

  analyser.getByteFrequencyData(dataArray);
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const barWidth = (canvas.width / dataArray.length) * 1.5;
  let x = 0;
  for (let i = 0; i < dataArray.length; i++) {
    const barHeight = dataArray[i];
    const hue = (i / dataArray.length) * 360;
    ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
    ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
    x += barWidth + 1;
  }
}
</script>
</body>
</html>
